<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–≤–µ—Ä–∏–Ω—ã–π Dig Dug ü¶ä</title>
    <style>
        body {
            background-color: #2A2A2A;
            color: #fff;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        
        h1 {
            color: #FFA500;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }
        
        #game-container {
            position: relative;
            width: 400px;
            height: 600px;
            border: 4px solid #555;
            background-color: #87CEEB;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        #surface-world {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 200px;
            display: grid;
            grid-template-columns: repeat(20, 20px);
            grid-template-rows: repeat(10, 20px);
            z-index: 1;
        }
        
        #underground-world {
            position: absolute;
            top: 200px;
            left: 0;
            width: 100%;
            height: 400px;
            display: grid;
            grid-template-columns: repeat(20, 20px);
            grid-template-rows: repeat(20, 20px);
            z-index: 2;
        }
        
        .cell {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
        }
        
        .sky {
            background-color: #87CEEB;
        }
        
        .cloud {
            background-color: transparent;
            text-align: center;
            font-size: 80px;
            line-height: 40px;
            transform: translateY(-15px);
            z-index: 1;
        }
        
        .tree {
            background-color: transparent;
            text-align: center;
            font-size: 100px;
            line-height: 40px;
            transform: translateY(-15px);
            z-index: 1;
        }
        
        .grass {
            background-color: transparent;
            text-align: center;
            font-size: 20px;
            z-index: 2;
            position: relative;
        }
        
        .mushroom {
            background-color: transparent;
            text-align: center;
            font-size: 20px;
            z-index: 2;
            position: relative;
        }
        
        .unbreakable {
            background-color: #228B22;
            border: 1px solid #006400;
        }
        
        .hole {
            background-color: #000000;
            border: 1px solid #006400;
        }
        
        .dirt {
            background-color: #654321;
            border: 1px solid #543210;
        }
        
        .empty {
            background-color: #000000;
            border: 1px solid #321000;
        }
        
        .player {
            background-color: #000000;
            text-align: center;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 20px;
            width: 20px;
            line-height: 20px;
        }
        
        .player.flipped {
            transform: scaleX(-1);
        }
        
        .enemy {
            background-color: #000000;
            text-align: center;
            font-size: 20px;
        }
        
        .carrot {
            background-color: #000000;
            text-align: center;
            font-size: 20px;
        }
        
        .diamond {
            background-color: #000000;
            text-align: center;
            font-size: 20px;
        }
        
        .rock {
            background-color: #000000;
            text-align: center;
            font-size: 20px;
        }
        
        #score-panel {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            width: 400px;
            padding: 10px;
            background-color: #333;
            border: 2px solid #555;
        }
        
        #message-box {
            margin-top: 10px;
            padding: 10px;
            width: 400px;
            height: 50px;
            background-color: #333;
            border: 2px solid #555;
            text-align: center;
            font-size: 18px;
        }
        
        #controls {
            margin-top: 20px;
            text-align: center;
        }
        
        button {
            background-color: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background-color: #777;
        }
    </style>
</head>
<body>
    <h1>–ó–≤–µ—Ä–∏–Ω—ã–π Dig Dug ü¶ä</h1>
    <div id="game-container">
        <div id="surface-world"></div>
        <div id="underground-world"></div>
    </div>
    <div id="score-panel">
        <div>–°—á–µ—Ç: <span id="score">0</span></div>
        <div>–ñ–∏–∑–Ω–∏: <span id="lives">3</span></div>
        <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
    </div>
    <div id="message-box">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è. –°–æ–±–∏—Ä–∞–π—Ç–µ –º–æ—Ä–∫–æ–≤–∫–∏ ü•ï –∏ –∞–ª–º–∞–∑—ã üíé, —Å–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ –∫–∞–º–Ω–∏ üß± –Ω–∞ –≤—Ä–∞–≥–æ–≤!</div>
    <div id="controls">
        <button id="start-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="restart-button" style="display: none;">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        const ROWS = 20;
        const COLS = 20;
        const SURFACE_ROWS = 10;
        const EMPTY = 0;
        const DIRT = 1;
        const PLAYER = 2;
        const ENEMY = 3;
        const CARROT = 4;
        const DIAMOND = 5;
        const ROCK = 6;
        const CLOUD = 7;
        const TREE = 8;
        const GRASS = 9;
        const MUSHROOM = 10;
        const UNBREAKABLE = 11;
        const HOLE = 12;
        
        let surfaceBoard = [];
        let undergroundBoard = [];
        let score = 0;
        let lives = 3;
        let level = 1;
        let gameRunning = false;
        let playerPosition = { x: 0, y: 0 };
        let playerDirection = 'left';
        let enemies = [];
        let carrots = [];
        let diamonds = [];
        let rocks = [];
        let gameInterval;
        let levelUpInProgress = false;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const surfaceWorldElement = document.getElementById('surface-world');
        const undergroundWorldElement = document.getElementById('underground-world');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        const messageBox = document.getElementById('message-box');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            clearInterval(gameInterval);
            surfaceBoard = [];
            undergroundBoard = [];
            enemies = [];
            carrots = [];
            diamonds = [];
            rocks = [];
            score = 0;
            lives = 3;
            level = 1;
            gameRunning = true;
            
            scoreElement.textContent = score;
            livesElement.textContent = lives;
            levelElement.textContent = level;
            
            createSurfaceWorld();
            createUndergroundWorld();
            
            playerPosition = { x: 2, y: 1 };
            undergroundBoard[1][2] = PLAYER;
            
            placeEnemies(3 + Math.floor(level / 2));
            placeCarrots(5 + level);
            placeDiamonds(3 + Math.floor(level / 2));
            placeRocks(8 + Math.floor(level / 2));
            
            renderBoards();
            
            gameInterval = setInterval(gameLoop, 500);
            
            messageBox.textContent = "–£—Ä–æ–≤–µ–Ω—å 1! –°–æ–±–∏—Ä–∞–π –º–æ—Ä–∫–æ–≤–∫–∏ –∏ –∞–ª–º–∞–∑—ã, —É–Ω–∏—á—Ç–æ–∂–∞–π –≤—Ä–∞–≥–æ–≤!";
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–¥–∑–µ–º–Ω–æ–≥–æ –º–∏—Ä–∞
        function createSurfaceWorld() {
            surfaceWorldElement.innerHTML = '';
            
            for (let y = 0; y < SURFACE_ROWS; y++) {
                surfaceBoard[y] = [];
                for (let x = 0; x < COLS; x++) {
                    surfaceBoard[y][x] = EMPTY;
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell sky';
                    cell.id = `surface-cell-${y}-${x}`;
                    surfaceWorldElement.appendChild(cell);
                }
            }
            
            // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            placeSurfaceElements();
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function placeSurfaceElements() {
            // –°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–º–µ—â–∞–µ–º –∑–∞–¥–Ω–∏–π –ø–ª–∞–Ω (–¥–µ—Ä–µ–≤—å—è)
            for (let i = 0; i < 3; i++) {
                let x = Math.floor(Math.random() * COLS);
                surfaceBoard[8][x] = TREE;
            }

            // –ó–∞—Ç–µ–º –æ–±–ª–∞–∫–∞
            for (let i = 0; i < 5; i++) {
                let x = Math.floor(Math.random() * COLS);
                let y = Math.floor(Math.random() * 2) + 2;
                surfaceBoard[y][x] = CLOUD;
            }
            
            // –í –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω (—Ç—Ä–∞–≤–∞ –∏ –≥—Ä–∏–±—ã)
            for (let i = 0; i < 10; i++) {
                let x = Math.floor(Math.random() * COLS);
                surfaceBoard[9][x] = GRASS;
            }
            
            for (let i = 0; i < 4; i++) {
                let x = Math.floor(Math.random() * COLS);
                surfaceBoard[9][x] = MUSHROOM;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–≤–∏–ª–∏—Å—Ç–æ–≥–æ —Ç—É–Ω–Ω–µ–ª—è
        function createWigglyTunnel(startX, startY, endX, endY) {
            let currentX = startX;
            let currentY = startY;
            
            while (currentX !== endX || currentY !== endY) {
                undergroundBoard[currentY][currentX] = EMPTY;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
                let dx = 0;
                let dy = 0;
                
                // –° –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –≤—ã–±–∏—Ä–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ X –∏–ª–∏ Y
                if (Math.random() < 0.5 && currentX !== endX) {
                    dx = currentX < endX ? 1 : -1;
                } else if (currentY !== endY) {
                    dy = currentY < endY ? 1 : -1;
                } else {
                    dx = currentX < endX ? 1 : -1;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
                if (Math.random() < 0.3) {
                    // –†–∞—Å—à–∏—Ä—è–µ–º —Ç—É–Ω–Ω–µ–ª—å –≤ —Å–ª—É—á–∞–π–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
                    let offsetX = Math.random() < 0.5 ? 1 : -1;
                    let offsetY = Math.random() < 0.5 ? 1 : -1;
                    
                    if (currentX + offsetX >= 0 && currentX + offsetX < COLS &&
                        currentY + offsetY >= 1 && currentY + offsetY < ROWS) {
                        undergroundBoard[currentY + offsetY][currentX] = EMPTY;
                        undergroundBoard[currentY][currentX + offsetX] = EMPTY;
                    }
                }
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–µ
                currentX += dx;
                currentY += dy;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                currentX = Math.max(0, Math.min(currentX, COLS - 1));
                currentY = Math.max(1, Math.min(currentY, ROWS - 1));
            }
            
            // –î–µ–ª–∞–µ–º –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É –ø—É—Å—Ç–æ–π
            undergroundBoard[endY][endX] = EMPTY;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ç—É–Ω–Ω–µ–ª–µ–π
        function createInitialTunnels() {
            // –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å –æ—Ç –Ω–æ—Ä—ã
            createWigglyTunnel(2, 1, 2, 18);
            
            // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∏–∑–≤–∏–ª–∏—Å—Ç—ã—Ö —Ç—É–Ω–Ω–µ–ª—è
            createWigglyTunnel(2, 5, COLS - 3, 5);
            createWigglyTunnel(2, 11, COLS - 3, 11);
            createWigglyTunnel(2, 17, COLS - 3, 17);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—É–Ω–Ω–µ–ª–µ–π
            createWigglyTunnel(6, 5, 6, 17);
            createWigglyTunnel(14, 5, 14, 17);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—É–ø–∏–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–≤–ª–µ–Ω–∏–π –¥–ª—è —É–∫—Ä—ã—Ç–∏–π
            createWigglyTunnel(6, 8, 10, 8);
            createWigglyTunnel(14, 14, 18, 14);
            createWigglyTunnel(3, 3, 8, 3);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∑–µ–º–Ω–æ–≥–æ –º–∏—Ä–∞
        function createUndergroundWorld() {
            undergroundWorldElement.innerHTML = '';
            
            for (let y = 0; y < ROWS; y++) {
                undergroundBoard[y] = [];
                for (let x = 0; x < COLS; x++) {
                    // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –Ω–µ—É–Ω–∏—á—Ç–æ–∂–∞–µ–º–∞—è –∑–µ–º–ª—è —Å –Ω–æ—Ä–æ–π
                    if (y === 0) {
                        if (x === 2) {
                            undergroundBoard[y][x] = HOLE;
                        } else {
                            undergroundBoard[y][x] = UNBREAKABLE;
                        }
                    } else {
                        undergroundBoard[y][x] = DIRT;
                    }
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell dirt';
                    cell.id = `underground-cell-${y}-${x}`;
                    undergroundWorldElement.appendChild(cell);
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç—É–Ω–Ω–µ–ª–µ–π
            createInitialTunnels();
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        function placeEnemies(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * COLS);
                    y = Math.floor(Math.random() * ROWS);
                } while (undergroundBoard[y][x] !== EMPTY || // –¢–æ–ª—å–∫–æ –≤ —Ç—É–Ω–Ω–µ–ª—è—Ö
                        (x === playerPosition.x && y === playerPosition.y));
                
                undergroundBoard[y][x] = ENEMY;
                enemies.push({ x, y });
            }
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –º–æ—Ä–∫–æ–≤–æ–∫
        function placeCarrots(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * COLS);
                    y = Math.floor(Math.random() * 8) + 2; // –ë–ª–∏–∂–µ –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
                } while (undergroundBoard[y][x] !== EMPTY || // –¢–æ–ª—å–∫–æ –≤ —Ç—É–Ω–Ω–µ–ª—è—Ö
                        (x === playerPosition.x && y === playerPosition.y));
                
                undergroundBoard[y][x] = CARROT;
                carrots.push({ x, y });
            }
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∞–ª–º–∞–∑–æ–≤
        function placeDiamonds(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * COLS);
                    y = Math.floor(Math.random() * 5) + 12; // –ì–ª—É–±–∂–µ –≤ —Ç—É–Ω–Ω–µ–ª—è—Ö
                } while (undergroundBoard[y][x] !== EMPTY || // –¢–æ–ª—å–∫–æ –≤ —Ç—É–Ω–Ω–µ–ª—è—Ö
                        (x === playerPosition.x && y === playerPosition.y));
                
                undergroundBoard[y][x] = DIAMOND;
                diamonds.push({ x, y });
            }
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞–º–Ω–µ–π
        function placeRocks(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * COLS);
                    y = Math.floor(Math.random() * (ROWS - 2)) + 2;
                } while (undergroundBoard[y][x] !== DIRT);
                
                undergroundBoard[y][x] = ROCK;
                rocks.push({ x, y, falling: false });
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–±–æ–∏—Ö –º–∏—Ä–æ–≤
        function renderBoards() {
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –Ω–∞–¥–∑–µ–º–Ω–æ–≥–æ –º–∏—Ä–∞
            for (let y = 0; y < SURFACE_ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    const cell = document.getElementById(`surface-cell-${y}-${x}`);
                    
                    switch (surfaceBoard[y][x]) {
                        case EMPTY:
                            cell.className = 'cell sky';
                            cell.textContent = '';
                            break;
                        case CLOUD:
                            cell.className = 'cell cloud';
                            cell.textContent = '‚òÅÔ∏è';
                            break;
                        case TREE:
                            cell.className = 'cell tree';
                            cell.textContent = 'üå≥';
                            break;
                        case GRASS:
                            cell.className = 'cell grass';
                            cell.textContent = 'üå±';
                            break;
                        case MUSHROOM:
                            cell.className = 'cell mushroom';
                            cell.textContent = 'üçÑ';
                            break;
                    }
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–¥–∑–µ–º–Ω–æ–≥–æ –º–∏—Ä–∞
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    const cell = document.getElementById(`underground-cell-${y}-${x}`);
                    
                    switch (undergroundBoard[y][x]) {
                        case EMPTY:
                            cell.className = 'cell empty';
                            cell.textContent = '';
                            break;
                        case DIRT:
                            cell.className = 'cell dirt';
                            cell.textContent = '';
                            break;
                        case UNBREAKABLE:
                            cell.className = 'cell unbreakable';
                            cell.textContent = '';
                            break;
                        case HOLE:
                            cell.className = 'cell hole';
                            cell.textContent = '';
                            break;
                        case PLAYER:
                            cell.className = 'cell player';
                            cell.textContent = 'üêá';
                            if (playerPosition.x === x && playerPosition.y === y && playerDirection === 'right') {
                                cell.classList.add('flipped');
                            }
                            break;
                        case ENEMY:
                            cell.className = 'cell enemy';
                            cell.textContent = 'üêç';
                            break;
                        case CARROT:
                            cell.className = 'cell carrot';
                            cell.textContent = 'ü•ï';
                            break;
                        case DIAMOND:
                            cell.className = 'cell diamond';
                            cell.textContent = 'üíé';
                            break;
                        case ROCK:
                            cell.className = 'cell rock';
                            cell.textContent = 'üß±';
                            break;
                    }
                }
            }
        }
        
        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function movePlayer(dx, dy) {
            if (!gameRunning || levelUpInProgress) return;
            
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;
            
            if (newX < 0 || newX >= COLS || newY < 0 || newY >= ROWS) {
                return;
            }
            
            if (undergroundBoard[newY][newX] === UNBREAKABLE) {
                return;
            }
            
            // –ú–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
            if (dx > 0) playerDirection = 'right';
            if (dx < 0) playerDirection = 'left';
            
            if (undergroundBoard[newY][newX] === ROCK) {
                const rockNewX = newX + dx;
                const rockNewY = newY + dy;
                
                if (rockNewX >= 0 && rockNewX < COLS && rockNewY >= 0 && rockNewY < ROWS && 
                    undergroundBoard[rockNewY][rockNewX] === EMPTY) {
                    
                    undergroundBoard[newY][newX] = EMPTY;
                    undergroundBoard[rockNewY][rockNewX] = ROCK;
                    
                    const rockIndex = rocks.findIndex(r => r.x === newX && r.y === newY);
                    if (rockIndex !== -1) {
                        rocks[rockIndex].x = rockNewX;
                        rocks[rockIndex].y = rockNewY;
                        rocks[rockIndex].falling = true;
                    }
                } else {
                    return;
                }
            }
            
            if (undergroundBoard[newY][newX] === DIRT) {
                undergroundBoard[newY][newX] = EMPTY;
            }
            
            let itemCollected = false;
            
            if (undergroundBoard[newY][newX] === CARROT) {
                score += 100;
                scoreElement.textContent = score;
                carrots = carrots.filter(c => c.x !== newX || c.y !== newY);
                itemCollected = true;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞ –º–æ—Ä–∫–æ–≤–∫–∏
                const cell = document.getElementById(`underground-cell-${newY}-${newX}`);
                cell.textContent = '‚ú®';
                setTimeout(() => {
                    if (cell) cell.textContent = '';
                }, 300);
                
            }
            
            if (undergroundBoard[newY][newX] === DIAMOND) {
                score += 300;
                scoreElement.textContent = score;
                diamonds = diamonds.filter(d => d.x !== newX || d.y !== newY);
                itemCollected = true;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞ –∞–ª–º–∞–∑–∞
                const cell = document.getElementById(`underground-cell-${newY}-${newX}`);
                cell.textContent = '‚ú®';
                setTimeout(() => {
                    if (cell) cell.textContent = '';
                }, 300);
            }
            
            undergroundBoard[playerPosition.y][playerPosition.x] = EMPTY;
            undergroundBoard[newY][newX] = PLAYER;
            playerPosition.x = newX;
            playerPosition.y = newY;
            
            // –ü–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∏ —Å–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–∞–≥–∞
            if (enemies.some(e => e.x === newX && e.y === newY)) {
                playerDie();
                renderBoards();
                return;
            }
            
            renderBoards();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª —Å–æ–±—Ä–∞–Ω –ø—Ä–µ–¥–º–µ—Ç
            if (itemCollected) {
                checkLevelUp();
            }
        }
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        function moveEnemies() {
            for (let i = 0; i < enemies.length; i++) {
                const enemy = enemies[i];
                
                // –ù–∞—Ö–æ–¥–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø–æ —Ç—É–Ω–Ω–µ–ª—è–º)
                const possibleMoves = [];
                const directions = [
                    { dx: 0, dy: -1 },
                    { dx: 1, dy: 0 },
                    { dx: 0, dy: 1 },
                    { dx: -1, dy: 0 }
                ];
                
                for (const dir of directions) {
                    const newX = enemy.x + dir.dx;
                    const newY = enemy.y + dir.dy;
                    
                    if (newX >= 0 && newX < COLS && newY >= 0 && newY < ROWS && 
                        (undergroundBoard[newY][newX] === EMPTY || undergroundBoard[newY][newX] === PLAYER)) {
                        possibleMoves.push({ x: newX, y: newY });
                    }
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
                if (possibleMoves.length > 0) {
                    const move = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    
                    if (undergroundBoard[move.y][move.x] === PLAYER) {
                        playerDie();
                        return;
                    }
                    
                    undergroundBoard[enemy.y][enemy.x] = EMPTY;
                    undergroundBoard[move.y][move.x] = ENEMY;
                    enemy.x = move.x;
                    enemy.y = move.y;
                }
            }
        }
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–Ω–µ–π
        function moveRocks() {
            if (levelUpInProgress) return;
            
            let enemyKilled = false;
            for (let i = 0; i < rocks.length; i++) {
                const rock = rocks[i];
                
                if (rock.y < ROWS - 1) {
                    const cellBelow = undergroundBoard[rock.y + 1][rock.x];
                    
                    if (cellBelow === EMPTY) {
                        // –ö–∞–º–µ–Ω—å –ø–∞–¥–∞–µ—Ç –≤ –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
                        rock.falling = true;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–∞–¥–∞–µ—Ç –ª–∏ –∫–∞–º–µ–Ω—å –Ω–∞ –∏–≥—Ä–æ–∫–∞
                        if (rock.y + 1 === playerPosition.y && rock.x === playerPosition.x) {
                            playerDie();
                            return;
                        }
                        
                        undergroundBoard[rock.y][rock.x] = EMPTY;
                        undergroundBoard[rock.y + 1][rock.x] = ROCK;
                        rock.y++;
                        
                    } else if (cellBelow === ENEMY && rock.falling) {
                        // –ö–∞–º–µ–Ω—å –ø–∞–¥–∞–µ—Ç –Ω–∞ –≤—Ä–∞–≥–∞
                        const enemyIndex = enemies.findIndex(e => e.x === rock.x && e.y === rock.y + 1);
                        if (enemyIndex !== -1) {
                            // –£–¥–∞–ª—è–µ–º –≤—Ä–∞–≥–∞
                            enemies.splice(enemyIndex, 1);
                            score += 200;
                            scoreElement.textContent = score;
                            
                            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∞–Ω–∏–º–∞—Ü–∏–∏
                            const cell = document.getElementById(`underground-cell-${rock.y + 1}-${rock.x}`);
                            
                            // –ü–µ—Ä–≤—ã–π –∫–∞–¥—Ä –≤–∑—Ä—ã–≤–∞
                            cell.textContent = 'üí•';
                            undergroundBoard[rock.y + 1][rock.x] = EMPTY;
                            
                            // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
                            setTimeout(() => {
                                if (cell) cell.textContent = 'üí´';
                                setTimeout(() => {
                                    if (cell) cell.textContent = '‚ú®';
                                    setTimeout(() => {
                                        if (cell) cell.textContent = '';
                                    }, 100);
                                }, 100);
                            }, 100);
                            
                            enemyKilled = true;
                        }
                    } else {
                        // –ö–∞–º–µ–Ω—å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
                        rock.falling = false;
                    }
                } else {
                    rock.falling = false;
                }
            }
            
            return enemyKilled;
        }
        
        // –°–º–µ—Ä—Ç—å –∏–≥—Ä–æ–∫–∞
        function playerDie() {
            lives--;
            livesElement.textContent = lives;
            
            if (lives <= 0) {
                gameOver();
                return;
            }
            
            messageBox.textContent = "–û–π! –¢—ã –ø–æ–ø–ª–∞—Ç–∏–ª—Å—è –∂–∏–∑–Ω—å—é!";
            
            const emptyPositions = [];
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (undergroundBoard[y][x] === EMPTY) {
                        emptyPositions.push({ x, y });
                    }
                }
            }
            
            if (emptyPositions.length > 0) {
                const newPos = emptyPositions[Math.floor(Math.random() * emptyPositions.length)];
                undergroundBoard[playerPosition.y][playerPosition.x] = EMPTY;
                undergroundBoard[newPos.y][newPos.x] = PLAYER;
                playerPosition.x = newPos.x;
                playerPosition.y = newPos.y;
                renderBoards();
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function gameOver() {
            gameRunning = false;
            clearInterval(gameInterval);
            messageBox.textContent = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –¢–≤–æ–π —Å—á–µ—Ç: ${score}`;
            restartButton.style.display = 'inline-block';
            startButton.style.display = 'none';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
        function checkLevelUp() {
            if (carrots.length === 0 && diamonds.length === 0 && !levelUpInProgress) {
                levelUpInProgress = true;
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
                clearInterval(gameInterval);
                // –ë–ª–æ–∫–∏—Ä—É–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                gameRunning = false;
                setTimeout(() => {
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å!');
                    levelUp();
                }, 1000);
            }
        }
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
        function levelUp() {
            console.log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è levelUp');
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
            level++;
            levelElement.textContent = level;
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –º–∞—Å—Å–∏–≤—ã
            enemies = [];
            carrots = [];
            diamonds = [];
            rocks = [];
            
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ –ø–æ–¥–∑–µ–º–µ–ª—å–µ —Å —Ç—É–Ω–Ω–µ–ª—è–º–∏
            createUndergroundWorld();
            playerPosition = { x: 2, y: 1 };
            undergroundBoard[1][2] = PLAYER;
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            placeEnemies(3 + Math.floor(level / 2));
            placeCarrots(5 + level);
            placeDiamonds(3 + Math.floor(level / 2));
            placeRocks(8 + Math.floor(level / 2));
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
            createSurfaceWorld();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            renderBoards();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            messageBox.textContent = `–£—Ä–æ–≤–µ–Ω—å ${level}! –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–µ–Ω–∞! –°–æ–±–∏—Ä–∞–π –º–æ—Ä–∫–æ–≤–∫–∏ –∏ –∞–ª–º–∞–∑—ã, —É–Ω–∏—á—Ç–æ–∂–∞–π –≤—Ä–∞–≥–æ–≤!`;
            
            // –ë–æ–Ω—É—Å –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            score += level * 500;
            scoreElement.textContent = score;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–µ—Ö–æ–¥–∞ —É—Ä–æ–≤–Ω—è
            levelUpInProgress = false;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –∑–∞–Ω–æ–≤–æ
            gameRunning = true;
            gameInterval = setInterval(gameLoop, 500);
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameRunning) return;
            
            moveEnemies();
            moveRocks();
            renderBoards();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch (e.key) {
                case 'ArrowUp':
                    movePlayer(0, -1);
                    break;
                case 'ArrowRight':
                    movePlayer(1, 0);
                    break;
                case 'ArrowDown':
                    movePlayer(0, 1);
                    break;
                case 'ArrowLeft':
                    movePlayer(-1, 0);
                    break;
            }
        });
        
        startButton.addEventListener('click', () => {
            initGame();
            startButton.style.display = 'none';
            restartButton.style.display = 'inline-block';
        });
        
        restartButton.addEventListener('click', () => {
            initGame();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã
        createSurfaceWorld();
        createUndergroundWorld();
    </script>
</body>
</html>